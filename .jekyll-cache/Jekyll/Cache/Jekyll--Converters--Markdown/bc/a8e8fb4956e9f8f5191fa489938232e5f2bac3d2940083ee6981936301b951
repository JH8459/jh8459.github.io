I"<p><img src="https://user-images.githubusercontent.com/83164003/152715311-82cc5a61-ca9c-4c46-a955-77970d4449bb.jpg" alt="Project" /></p>

<h2 id="refactoring">Refactoring</h2>
<p>현재 ALL-CON 프로젝트의 DB 서버는 <strong>AWS RDS</strong>를 사용하고 있다.</p>

<p>DB의 서버시간이 맞지 않는 문제가 계속 발생하고 있다.<br />
DB 서버에 저장되는 <strong>포르테 디 콰트로 콘서트 메타포닉-부산</strong>의 <code class="language-plaintext highlighter-rouge">open_date</code>(티켓오픈일) 값은 다음과 같다.</p>

<table>
  <thead>
    <tr>
      <th>open_date</th>
      <th>title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2022-02-22 23:00:00</td>
      <td>포르테 디 콰트로 콘서트 <메타포닉> - 부산</메타포닉></td>
    </tr>
  </tbody>
</table>

<p>하지만 인터파크 티켓에서 기재된 티켓오픈일 정보는 아래와 같다.</p>

<p><img src="https://user-images.githubusercontent.com/83164003/154224099-785d11be-21dc-4b9f-b240-77bf0ee109f6.png" alt="스크린샷, 2022-02-16 17-21-00" /></p>

<p>안맞는 시간을 클라이언트에서 강제로 조정해주어서 우선 도메인에서는 정상적으로 보이지만, 근본적인 해결책은 아니였기 때문에 DB 시간문제를 해결하기로 결정하였다.</p>

<h3 id="1-보완이-필요한-사항">1. 보완이 필요한 사항</h3>
<hr />

<h4 id="1-1-db-server-시간-안맞음">1-1. DB Server 시간 안맞음</h4>
<hr />

<p>위에서 언급한 대로 DB의 시간 설정이 9시간 맞지 않는다.</p>

<center><img src="https://user-images.githubusercontent.com/83164003/154257426-7ad705ef-b155-454d-9d1a-97a160f118a7.png" /></center>
<p><br /></p>

<p>mysql에서 현재 서버의 시간을 가져오는 함수인 <code class="language-plaintext highlighter-rouge">select now()</code> 를 사용시 다음 아래와 같은 서버시간이 출력된다. (현재 시간은 2월 16일 17시 5분경)</p>

<p>우선 서버 시간 자체가 맞지 않았다.<br />
현재 서버의 <strong>time_zone</strong>을 확인해보니 UTC(협정 세계시)인 점을 확인하였다.</p>

<center><img src="https://user-images.githubusercontent.com/83164003/154258039-72e3fb49-c5c9-4508-8b28-e7ab0b3041f0.png" /></center>
<p><br /></p>

<p>참고로 한국의 표준 시간대는 <strong>UTC+9</strong>이다. <del>(UTC+9의 “+9” 의미가 PLUS 9 였다!)</del></p>

<p>정확히 9시간이 협정 세계시와의 차이점으로 발생하고 있었다.</p>

<h3 id="2-문제-해결">2. 문제 해결</h3>
<hr />

<h4 id="2-1-aws-rds-mysql-시간-설정">2-1. AWS RDS mysql 시간 설정</h4>
<hr />

<p><a href="https://aws.amazon.com/ko/premiumsupport/knowledge-center/rds-change-time-zone/">공식문서</a>를 통해서 해당 내용이 문제점인지 파악하였다.</p>

<p>나는 클라이언트 배포를 담당하였기 때문에 RDS와 EC2는 다른 팀원분께서 담당해주셨다. 피드백을 전달하였고 팀원 분께서 RDS 설정을 수정해주셨다.</p>

<p>RDS 재부팅 후 정상적인  <strong>UTC+9</strong>  time_zone을 확인하였다.</p>

<center><img src="https://user-images.githubusercontent.com/83164003/154259305-b575d7e9-e444-4494-8f70-13d2f72039d0.png" /></center>

<h3 id="3-결과">3. 결과</h3>
<hr />

<p>RDS time_zone 설정을 바꾸었다고 기존 DB들이 저장된 시간값이 바뀌진 않기에 기존 DB는 수동으로  시간값을 “-9시간” 수정해주어야 할 듯 하다.</p>

<p>또한 기존의 9시간의 간격을 메꾸기 위해 억지로 <code class="language-plaintext highlighter-rouge">open_date</code>값을 수정해주는 얽힌 코드들은 내일 마저 수정 할 예정이다.</p>
:ET