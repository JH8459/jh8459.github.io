---
title: "[Project] ALL-CON Refactoring 8일차 - DB timezone 수정"
category: Project
excerpt: "[Project] ALL-CON Refactoring 8일차 - DB timezone 수정"
---

![Project](https://user-images.githubusercontent.com/83164003/152715311-82cc5a61-ca9c-4c46-a955-77970d4449bb.jpg)

## Refactoring
DB의 시간이 맞지 않는 문제가 계속 발생하고 있다.

DB 서버에 저장되는 **포르테 디 콰트로 콘서트 메타포닉-부산**의 `open_date`(티켓오픈일) 값은 다음과 같다.


| open_date | title |
| -------- | -------- |
| 2022-02-22 23:00:00  | 포르테 디 콰트로 콘서트 <메타포닉> - 부산 |
	
하지만 인터파크 티켓에서 기재된 티켓오픈일 정보는 아래와 같다.

 ![스크린샷, 2022-02-16 17-21-00](https://user-images.githubusercontent.com/83164003/154224099-785d11be-21dc-4b9f-b240-77bf0ee109f6.png)

안맞는 시간을 클라이언트에서 강제로 조정해주어서 우선 도메인에서는 정상적으로 보이지만, 근본적인 해결책은 아니였기 때문에 DB 시간문제를 해결하기로 결정하였다.


### 1. 보완이 필요한 사항
---

위에서 언급한 대로 시간 설정이 9시간 맞지 않는다.

<center><img src="https://user-images.githubusercontent.com/83164003/154257426-7ad705ef-b155-454d-9d1a-97a160f118a7.png"/></center><br>

mysql에서 현재 서버의 시간을 가져오는 함수인 `select now()` 를 사용시 다음 아래와 같은 서버시간이 출력된다. (현재 시간은 2월 16일 17시 5분경)

우선 서버 시간 자체가 맞지 않았다.<br>
현재 서버의 **time_zone**을 확인해보니 UTC(협정 세계시)인 점을 확인하였다.

<center><img src="https://user-images.githubusercontent.com/83164003/154258039-72e3fb49-c5c9-4508-8b28-e7ab0b3041f0.png"/></center><br>

참고로 한국의 표준 시간대는 **UTC+9**이다. ~~(UTC+9의 "+9" 의미가 PLUS 9 였다!)~~

정확히 9시간이 협정 세계시와의 차이점으로 발생하고 있었다.




### 2. 문제 해결
---

#### 2-1. AWS RDS mysql 시간 설정
---

<a href="https://aws.amazon.com/ko/premiumsupport/knowledge-center/rds-change-time-zone/">공식문서</a>를 통해서 해당 내용이 문제점인지 파악하였다.

나는 클라이언트 배포를 담당하였기 때문에 RDS와 EC2는 다른 팀원분께서 담당해주셨다. 피드백을 전달하였고 팀원 분께서 RDS 설정을 수정해주셨다. 

RDS 재부팅 후 정상적인  **UTC+9**  time_zone을 확인하였다.

<center><img src="https://user-images.githubusercontent.com/83164003/154259305-b575d7e9-e444-4494-8f70-13d2f72039d0.png"/></center>

### 3. 결과
---

RDS time_zone 설정을 바꾸었다고 기존 DB들이 저장된 시간값이 바뀌진 않기에 기존 DB는 수동으로  시간값을 "-9시간" 수정해주어야 할 듯 하다.

또한 기존의 9시간의 간격을 메꾸기 위해 억지로 `open_date`값을 수정해주는 로직들이 많아서 관련 코드는 내일 수정을 해 볼 예정이다.
